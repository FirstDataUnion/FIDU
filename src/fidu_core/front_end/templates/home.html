{% extends "base.html" %}

{% block title %}FIDU Core - Welcome{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100">
    <div class="max-w-md w-full space-y-8 p-8">
        <div class="text-center">
            <h1 class="text-4xl font-bold text-gray-900 mb-2">FIDU Core</h1>
            <p class="text-gray-600">Your Personal Data Management System</p>
        </div>
        
        <div class="bg-white rounded-lg shadow-lg p-8 space-y-6">
            <div class="text-center">
                <h2 class="text-2xl font-semibold text-gray-900 mb-4">Welcome</h2>
                <p class="text-gray-600 mb-6">Sign in to your account or create a new one to get started.</p>
            </div>
            
            <!-- FIDU SDK Auth Widget -->
            <div id="fiduAuthContainer"></div>
            <script src="{{ identity_service_url }}/static/js/fidu-sdk.js"></script>
            <script>
            // Initialize FIDU SDK
            const fidu = new FIDUAuth({
                fiduHost: '{{ identity_service_url }}',
                debug: true
            });

            // Set up event handlers
            fidu.on('onAuthSuccess', (user, token, portalUrl) => {
                localStorage.setItem('auth_token', token);
                // Set auth_token cookie for backend compatibility (expires in 1 hour)
                document.cookie = `auth_token=${token}; path=/; max-age=3600; samesite=lax`;
                window.location.href = "/dashboard";
            });

            fidu.on('onAuthError', (error) => {
                console.error('Auth error:', error);
            });

            // Check if user is already authenticated
            fidu.init().then(isAuthenticated => {
                if (!isAuthenticated) {
                    // Show login widget
                    fidu.showLoginWidget();
                }
            });
            </script>
        </div>
        
        <div class="text-center text-sm text-gray-500">
            <p>Secure • Fast • Reliable</p>
        </div>
    </div>
</div>
{% endblock %} 